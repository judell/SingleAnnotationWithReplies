<html>
<head>
<link rel="stylesheet" href="https://jonudell.info/hlib/hlib.css">
<script src="https://jonudell.info/hlib/hlib.bundle.js"></script>
<script src="https://jonudell.info/h/showdown.js"></script>
</head>
<body>

<div id="viewer">
</div>

<script>

function processResults(annos, replies) {
  annos = annos.map(anno => {
    return hlib.parseAnnotation(anno)
  })
  replies = replies.map(reply => {
    return hlib.parseAnnotation(reply)
  })
  let all = annos.concat(replies)
  all.forEach(anno => {
    let level = 0
    if (anno.refs) {
      level = anno.refs.length
    }  
    hlib.getById('viewer').innerHTML += hlib.showAnnotation(anno, level, 'https://hypothes.is/search?q=tag:')
  })
}

let id = hlib.gup('id')
let params = {
  'id': id,
}
hlib.hApiSearch(params, processResults)
</script>  

</body>
</html>
